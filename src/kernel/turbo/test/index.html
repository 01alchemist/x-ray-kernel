<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>X Ray kernel Test 1</title>

    <script src="../../../../node_modules/three/build/three.js"></script>
    <script src="../../../../libs/threejs/controls/EditorControls.js"></script>
    <script src="../../../../node_modules/three/examples/js/loaders/DDSLoader.js"></script>
    <script src="../../../../node_modules/three/examples/js/loaders/MTLLoader.js"></script>
    <script src="../../../../node_modules/three/examples/js/loaders/OBJLoader.js"></script>

    <script>
        exports = window.exports ? window.exports : {};
        SharedInt8Array = Int8Array;
    </script>

    <script src="../turbo-runtime.js"></script>
    <!--<script src="../src/api/Kernel.js"></script>ยง-->
</head>
<body>
<script>
    turbo.init(1024);
</script>
<script src="../xray-kernel-turbo.js"></script>
<script>
    let worker = new Worker("thread.js");
    worker.onmessage = function (msg) {
        console.log(msg);
        worker.postMessage(unsafe.RAW_MEMORY, [unsafe.RAW_MEMORY]);

        var name = "gopher";
        var folder = "gopher/";

        // texture
        var manager = new THREE.LoadingManager();
        /*manager.onProgress = function (item, loaded, total) {
         console.log(item, loaded, total);
         };*/
        manager.onLoad = function () {
            console.log(arguments);
        };

        var onProgress = function (xhr) {
            if (xhr.lengthComputable) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log(Math.round(percentComplete) + '% downloaded of '+ Math.round(xhr.total / (1024 * 1024)));
            }
        };

        var onError = function (xhr) {
        };

        //THREE.Loader.Handlers.add( /\.dds$/i, new THREE["DDSLoader"]() );
        var mtlLoader = new THREE["MTLLoader"](manager);
        mtlLoader.setPath('./models/' + folder);
        mtlLoader.load(name + '.mtl', function (materials) {
            var objLoader = new THREE["OBJLoader"]();
            objLoader.setMaterials(materials);
            objLoader.setPath('./models/' + folder);
            materials.preload();
            objLoader.load(name + '.obj', function (object) {
                // object.position.y = -95;
                object.scale.set(0.3, 0.3, 0.3);
                object.smooth = true;

                console.time("BufferGeometry::Create");
                xray.BufferGeometry.NewBufferGeometry(object);
                console.timeEnd("BufferGeometry::Create");

            }, onProgress, onError);
        });

//        xray.OBJLoader.Load("models/cornellbox_suzanne_lucy.obj", function (meshRef) {
//            xray.Mesh.Compile(meshRef);
//        });
    };
</script>
</body>
</html>